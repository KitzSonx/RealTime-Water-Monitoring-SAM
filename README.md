# ðŸŒŠ AquaWatch: Real-Time Water Level Monitoring using SAM

AquaWatch à¹€à¸›à¹‡à¸™à¸£à¸°à¸šà¸šà¹€à¸à¹‰à¸²à¸£à¸°à¸§à¸±à¸‡à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³à¹à¸šà¸š Real-Time à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ Computer Vision à¹à¸¥à¸° **Segment Anything Model (SAM)** à¹€à¸žà¸·à¹ˆà¸­à¸­à¹ˆà¸²à¸™à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³à¸ˆà¸²à¸à¹à¸–à¸šà¸§à¸±à¸”à¸œà¹ˆà¸²à¸™à¸à¸¥à¹‰à¸­à¸‡ IP Camera, à¹€à¸à¹‡à¸šà¸«à¸¥à¸±à¸à¸à¸²à¸™à¸ à¸²à¸žà¸¥à¸‡ Google Drive, à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹„à¸›à¸¢à¸±à¸‡ LINE

![](./media/waterlevel.png)

---

## âš ï¸ à¸„à¸³à¹€à¸•à¸·à¸­à¸™à¸”à¹‰à¸²à¸™à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ (Security Warning)

à¹‚à¸›à¸£à¹€à¸ˆà¸„à¸™à¸µà¹‰à¸¡à¸µà¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š API à¸ à¸²à¸¢à¸™à¸­à¸ (LINE, Google Drive) **à¸«à¹‰à¸²à¸¡ Hard-code à¸à¸¸à¸à¹à¸ˆ API à¸¥à¸‡à¹ƒà¸™à¹‚à¸„à¹‰à¸”à¹€à¸”à¹‡à¸”à¸‚à¸²à¸”**

à¹‚à¸›à¸£à¹€à¸ˆà¸„à¸™à¸µà¹‰à¹ƒà¸Šà¹‰à¹„à¸Ÿà¸¥à¹Œ `.env` à¹ƒà¸™à¸à¸²à¸£à¸ˆà¸±à¸”à¹€à¸à¹‡à¸š Secrets à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”:
1.  à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `.env`
2.  à¸„à¸±à¸”à¸¥à¸­à¸à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸ˆà¸²à¸ `.env.example`
3.  à¹€à¸•à¸´à¸¡ "à¸à¸¸à¸à¹à¸ˆà¸¥à¸±à¸š" à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸¥à¸‡à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œ `.env`

---

## ðŸ›ï¸ à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡ (System Flow)

à¸£à¸°à¸šà¸šà¸—à¸³à¸‡à¸²à¸™à¹€à¸›à¹‡à¸™ Loop `while True` à¹‚à¸”à¸¢à¸¡à¸µà¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸”à¸±à¸‡à¸™à¸µà¹‰:

1.  **Capture:** à¸”à¸¶à¸‡à¸ à¸²à¸ž Snapshot à¸ˆà¸²à¸ URL à¸‚à¸­à¸‡ IP Camera (à¸œà¹ˆà¸²à¸™ Ngrok Tunnel)
2.  **Segment:** à¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥ SAM (vit_b) à¹à¸¥à¸°à¹ƒà¸Šà¹‰ `SamPredictor` à¸à¸±à¸š "à¸ˆà¸¸à¸”à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡" (`input_point`) à¸—à¸µà¹ˆà¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹„à¸§à¹‰ à¹€à¸žà¸·à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡ Mask à¸‚à¸­à¸‡à¸œà¸´à¸§à¸™à¹‰à¸³
3.  **Calculate:** à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¸‚à¸­à¸‡ Mask (pixel) à¸—à¸µà¹ˆà¹„à¸”à¹‰
4.  **Calibrate:** à¹à¸›à¸¥à¸‡à¸„à¹ˆà¸² "à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡ pixel" à¹€à¸›à¹‡à¸™ "à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³ (à¹€à¸¡à¸•à¸£)" à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¸ªà¸¹à¸•à¸£ Pixel-to-Meter Calibration à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸ˆà¸²à¸à¸à¸²à¸£à¸—à¸”à¸¥à¸­à¸‡ (`Output = 11 - (height / 35.89)`)
5.  **Classify:** à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³à¹€à¸›à¹‡à¸™ `waterphase` (1-7) à¹€à¸žà¸·à¹ˆà¸­à¸à¸³à¸«à¸™à¸”à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸­à¸±à¸™à¸•à¸£à¸²à¸¢
6.  **Log:** à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸ à¸²à¸ž Snapshot (à¸«à¸¥à¸±à¸à¸à¸²à¸™) à¸‚à¸¶à¹‰à¸™à¹„à¸›à¸¢à¸±à¸‡ Google Drive
7.  **Alert:** à¸«à¸²à¸ `waterphase` à¸¡à¸µà¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸ˆà¸²à¸à¸£à¸­à¸šà¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸² à¸£à¸°à¸šà¸šà¸ˆà¸°à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™ (à¸žà¸£à¹‰à¸­à¸¡à¸ à¸²à¸ž, à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³, à¹à¸¥à¸°à¸„à¸³à¹à¸™à¸°à¸™à¸³) à¸œà¹ˆà¸²à¸™ LINE Messaging API
8.  **Loop:** à¸£à¸­ 1 à¸™à¸²à¸—à¸µ (`time.sleep`) à¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¸à¸£à¸°à¸šà¸§à¸™à¸à¸²à¸£à¹ƒà¸«à¸¡à¹ˆ

---

## âœ¨ Key Features

* **AI-Powered Monitoring:** à¹ƒà¸Šà¹‰ Segment Anything Model (SAM) à¹ƒà¸™à¸à¸²à¸£à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸œà¸´à¸§à¸™à¹‰à¸³à¸­à¸¢à¹ˆà¸²à¸‡à¹à¸¡à¹ˆà¸™à¸¢à¸³
* **Non-Invasive:** à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Sensor à¹ƒà¸™à¸™à¹‰à¸³ à¹ƒà¸Šà¹‰à¹€à¸žà¸µà¸¢à¸‡à¸à¸¥à¹‰à¸­à¸‡ IP Camera à¸—à¸µà¹ˆà¸ªà¹ˆà¸­à¸‡à¹„à¸›à¸¢à¸±à¸‡à¹à¸–à¸šà¸§à¸±à¸”
* **Pixel-to-Meter Calibration:** à¸¡à¸µà¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¹€à¸—à¸µà¸¢à¸šà¸ªà¹€à¸à¸¥à¸ˆà¸£à¸´à¸‡ (à¸•à¹‰à¸­à¸‡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸­à¸‡)
* **Cloud Logging:** à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³à¹€à¸›à¹‡à¸™à¸£à¸¹à¸›à¸ à¸²à¸žà¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸šà¸™ Google Drive
* **Real-Time Alerts:** à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸œà¹ˆà¸²à¸™ LINE à¸—à¸±à¸™à¸—à¸µà¹€à¸¡à¸·à¹ˆà¸­à¸£à¸°à¸”à¸±à¸šà¸™à¹‰à¸³à¸¡à¸µà¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¹€à¸Ÿà¸ªà¸„à¸§à¸²à¸¡à¸­à¸±à¸™à¸•à¸£à¸²à¸¢

---

## ðŸ› ï¸ Technology Stack

* **AI/CV:** PyTorch, Segment Anything Model (SAM), OpenCV, Pillow
* **Backend:** Python
* **APIs:** Google Drive API (via `google-api-python-client`), LINE Messaging API
* **Utils:** NumPy, Matplotlib (à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸ªà¸”à¸‡à¸œà¸¥), Requests, PyTz

---

## âš™ï¸ Setup & Installation

1.  **Clone Repository:**
    ```bash
    git clone [https://github.com/KitzSonx/RealTime-Water-Monitoring-SAM.git](https://github.com/KitzSonx/AquaWatch-Real-Time-Water-Monitoring.git)
    cd AquaWatch-Real-Time-Water-Monitoring
    ```

2.  **Install Segment Anything (SAM):**
    ```bash
    pip install git+[https://github.com/facebookresearch/segment-anything.git](https://github.com/facebookresearch/segment-anything.git)
    ```

3.  **Install Python Dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Download SAM Model:**
    (à¹‚à¸„à¹‰à¸”à¸™à¸µà¹‰à¹ƒà¸Šà¹‰à¹‚à¸¡à¹€à¸”à¸¥ `vit_b` à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸‚à¸™à¸²à¸”à¹€à¸¥à¹‡à¸)
    ```bash
    mkdir models
    wget -P models [https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth](https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth)
    ```
    *(à¹„à¸Ÿà¸¥à¹Œà¹‚à¸¡à¹€à¸”à¸¥à¸™à¸µà¹‰à¸ˆà¸°à¸–à¸¹à¸ `.gitignore` à¸šà¸¥à¹‡à¸­à¸à¹„à¸§à¹‰ à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸‚à¸¶à¹‰à¸™ Repo)*

5.  **Setup Google Drive API:**
    * à¹„à¸›à¸—à¸µà¹ˆ Google Cloud Console à¹à¸¥à¸°à¸ªà¸£à¹‰à¸²à¸‡ Service Account
    * à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œ credentials `service_account.json`
    * à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `service_account.json.example` (à¸•à¸²à¸¡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡) à¹€à¸žà¸·à¹ˆà¸­à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡
    * *(à¹„à¸Ÿà¸¥à¹Œ `service_account.json` à¸ˆà¸£à¸´à¸‡à¸ˆà¸°à¸–à¸¹à¸ `.gitignore` à¸šà¸¥à¹‡à¸­à¸à¹„à¸§à¹‰)*

6.  **Configure Environment:**
    * à¸„à¸±à¸”à¸¥à¸­à¸ `.env.example` à¹„à¸›à¹€à¸›à¹‡à¸™à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆà¸Šà¸·à¹ˆà¸­ `.env`
    * **à¹€à¸•à¸´à¸¡à¸„à¹ˆà¸²à¸ˆà¸£à¸´à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”:** `LINE_ACCESS_TOKEN`, `USER_ID`, `PARENT_FOLDER_ID`, `IP_CAMERA_SNAPSHOT_URL`

7.  **à¸à¸²à¸£à¹€à¸—à¸µà¸¢à¸šà¸ªà¹€à¸à¸¥ (Calibration):**
    * à¸„à¹ˆà¸²à¹ƒà¸™ `.env` (`INPUT_POINT_X`, `INPUT_POINT_Y`, `CALIBRATION_FACTOR`, `CALIBRATION_OFFSET`) à¹€à¸›à¹‡à¸™à¸„à¹ˆà¸² "Magic Number" à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸à¸±à¸šà¸à¸¥à¹‰à¸­à¸‡à¹à¸¥à¸°à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸‚à¸­à¸‡à¸œà¸¡à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
    * à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¹€à¸›à¸´à¸”à¸ à¸²à¸ž Snapshot à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹€à¸­à¸‡, à¸«à¸²à¸žà¸´à¸à¸±à¸” (`X, Y`) à¸—à¸µà¹ˆà¸ˆà¸°à¹ƒà¸Šà¹‰à¹€à¸›à¹‡à¸™à¸ˆà¸¸à¸”à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡, à¹à¸¥à¸°à¸„à¸³à¸™à¸§à¸“à¸«à¸² "à¸ªà¸¹à¸•à¸£" à¹€à¸—à¸µà¸¢à¸šà¸ªà¹€à¸à¸¥ (Pixel -> Meter) à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹€à¸­à¸‡

8.  **Run the Monitor:**
    ```bash
    python src/main.py
    ```

---

## ðŸ“„ License

This project is licensed under the MIT License.